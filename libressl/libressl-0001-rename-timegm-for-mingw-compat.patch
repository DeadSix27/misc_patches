From e75d06505b612e0e5fb4fe88566bd775b5f5bd4e Mon Sep 17 00:00:00 2001
From: DeadSix27 <DeadSix27@users.noreply.github.com>
Date: Sun, 25 Feb 2018 07:56:18 +0100
Subject: [PATCH 1/1] rename timegm for mingw compat

---
 crypto/compat/timegm.c | 2 +-
 include/compat/time.h  | 2 +-
 update.sh              | 6 +++++-
 3 files changed, 7 insertions(+), 3 deletions(-)
 mode change 100644 => 100755 include/compat/time.h

diff --git a/crypto/compat/timegm.c b/crypto/compat/timegm.c
index 2658445..f2dc624 100644
--- a/crypto/compat/timegm.c
+++ b/crypto/compat/timegm.c
@@ -200,7 +200,7 @@ struct tm *__gmtime_r(const time_t *t, struct tm *tm)
 }
 #endif
 
-time_t timegm(struct tm *tm)
+time_t timegm_libressl_1(struct tm *tm)
 {
 	struct tm new;
 	long long t = __tm_to_secs(tm);
diff --git a/include/compat/time.h b/include/compat/time.h
old mode 100644
new mode 100755
index df65530..63d2bba
--- a/include/compat/time.h
+++ b/include/compat/time.h
@@ -19,7 +19,7 @@ struct tm *__gmtime_r(const time_t * t, struct tm * tm);
 #endif
 
 #ifndef HAVE_TIMEGM
-time_t timegm(struct tm *tm);
+time_t timegm_libressl_1(struct tm *tm);
 #endif
 
 #ifndef timespecsub
diff --git a/update.sh b/update.sh
index f11aa04..a4ce511 100755
--- a/update.sh
+++ b/update.sh
@@ -15,7 +15,11 @@ fi
 (cd openbsd
  git fetch
  git checkout $openbsd_branch
- git pull --rebase)
+ git pull --rebase
+ git reset --hard 223662ea513433a9ccc2cace29d93ab4d8025e33
+ wget https://raw.githubusercontent.com/DeadSix27/misc_patches/master/libressl/0001-rename-timegm-for-mingw-compat.patch
+ git apply "0001-rename-timegm-for-mingw-compat.patch"
+ rm "0001-rename-timegm-for-mingw-compat.patch")
 
 # setup source paths
 CWD=`pwd`
-- 
2.16.2

